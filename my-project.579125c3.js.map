{"mappings":"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","sources":["src/index.js"],"sourcesContent":["// 全局状态：保存学生、座位、选中项与当前网格设置\r\nconst state = {\r\n  students: [],\r\n  seats: [],\r\n  selectedSeatIndexes: new Set(),\r\n  gridConfig: { rows: 5, cols: 6, seatSize: 80 },\r\n};\r\n\r\n// 统一收集页面元素，方便后续引用\r\nconst elements = {\r\n  downloadTemplateBtn: document.getElementById(\"downloadTemplateBtn\"),\r\n  studentFile: document.getElementById(\"studentFile\"),\r\n  rowsInput: document.getElementById(\"rowsInput\"),\r\n  colsInput: document.getElementById(\"colsInput\"),\r\n  seatSizeInput: document.getElementById(\"seatSizeInput\"),\r\n  generateBtn: document.getElementById(\"generateBtn\"),\r\n  gridWrapper: document.getElementById(\"gridWrapper\"),\r\n  rowHeaders: document.getElementById(\"rowHeaders\"),\r\n  colHeaders: document.getElementById(\"colHeaders\"),\r\n  seatGrid: document.getElementById(\"seatGrid\"),\r\n  swapBtn: document.getElementById(\"swapBtn\"),\r\n  reshuffleSelectionBtn: document.getElementById(\"reshuffleSelectionBtn\"),\r\n  clearSelectionBtn: document.getElementById(\"clearSelectionBtn\"),\r\n  exportExcelBtn: document.getElementById(\"exportExcelBtn\"),\r\n  exportImageBtn: document.getElementById(\"exportImageBtn\"),\r\n  studentSummary: document.getElementById(\"studentSummary\"),\r\n  studentTableWrapper: document.getElementById(\"studentTableWrapper\"),\r\n  studentTableBody: document.getElementById(\"studentTableBody\"),\r\n};\r\n\r\n// 性别映射：兼容不同写法\r\nconst GENDER_LABEL = {\r\n  男: \"male\",\r\n  女: \"female\",\r\n  男生: \"male\",\r\n  女生: \"female\",\r\n  male: \"male\",\r\n  female: \"female\",\r\n};\r\n\r\n// 初始化入口：绑定全部事件\r\nfunction init() {\r\n  elements.downloadTemplateBtn.addEventListener(\"click\", downloadTemplate);\r\n  elements.studentFile.addEventListener(\"change\", handleFileUpload);\r\n  elements.generateBtn.addEventListener(\"click\", handleGenerateSeats);\r\n  elements.swapBtn.addEventListener(\"click\", swapSelectedSeats);\r\n  elements.reshuffleSelectionBtn.addEventListener(\"click\", reshuffleSelectedSeats);\r\n  elements.clearSelectionBtn.addEventListener(\"click\", clearSelectedSeats);\r\n  elements.exportExcelBtn.addEventListener(\"click\", exportExcel);\r\n  elements.exportImageBtn.addEventListener(\"click\", exportImage);\r\n\r\n  [\"rowsInput\", \"colsInput\", \"seatSizeInput\"].forEach((key) => {\r\n    elements[key].addEventListener(\"input\", () => {\r\n      const value = Number(elements[key].value);\r\n      if (value > 0) {\r\n        state.gridConfig = {\r\n          ...state.gridConfig,\r\n          rows: Number(elements.rowsInput.value),\r\n          cols: Number(elements.colsInput.value),\r\n          seatSize: Number(elements.seatSizeInput.value),\r\n        };\r\n        if (state.seats.length) {\r\n          renderSeatGrid();\r\n        }\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n// 供教师下载的模板示例\r\nfunction downloadTemplate() {\r\n  const sample = [\r\n    { StudentID: \"20230001\", Name: \"张三\", Gender: \"男\" },\r\n    { StudentID: \"20230002\", Name: \"李四\", Gender: \"女\" },\r\n  ];\r\n  const ws = XLSX.utils.json_to_sheet(sample);\r\n  const wb = XLSX.utils.book_new();\r\n  XLSX.utils.book_append_sheet(wb, ws, \"Template\");\r\n  XLSX.writeFile(wb, \"student_template.xlsx\");\r\n}\r\n\r\n// 根据文件类型调用对应解析方式\r\nfunction handleFileUpload(evt) {\r\n  const file = evt.target.files[0];\r\n  if (!file) {\r\n    return;\r\n  }\r\n  const ext = file.name.split(\".\").pop().toLowerCase();\r\n  if (ext === \"csv\") {\r\n    parseCsvFile(file);\r\n  } else if (ext === \"xlsx\" || ext === \"xls\") {\r\n    parseExcelFile(file);\r\n  } else {\r\n    alert(\"仅支持 CSV 或 Excel 文件。\");\r\n  }\r\n}\r\n\r\n// 解析 CSV 模板（UTF-8）\r\nfunction parseCsvFile(file) {\r\n  const reader = new FileReader();\r\n  reader.onload = (e) => {\r\n    const rows = e.target.result\r\n      .split(/\\r?\\n/)\r\n      .map((line) => line.trim())\r\n      .filter(Boolean);\r\n    const header = rows.shift()?.split(\",\").map((h) => h.trim());\r\n    if (!header || header.length < 3) {\r\n      alert(\"CSV 模板不正确。\");\r\n      return;\r\n    }\r\n    const data = rows.map((line) => {\r\n      const parts = line.split(\",\").map((v) => v.trim());\r\n      return {\r\n        StudentID: parts[0] || \"\",\r\n        Name: parts[1] || \"\",\r\n        Gender: parts[2] || \"\",\r\n      };\r\n    });\r\n    acceptStudentList(data);\r\n  };\r\n  reader.readAsText(file, \"utf-8\");\r\n}\r\n\r\n// 解析 Excel 模板\r\nfunction parseExcelFile(file) {\r\n  const reader = new FileReader();\r\n  reader.onload = (e) => {\r\n    const workbook = XLSX.read(new Uint8Array(e.target.result), { type: \"array\" });\r\n    const firstSheet = workbook.SheetNames[0];\r\n    const sheet = workbook.Sheets[firstSheet];\r\n    const data = XLSX.utils.sheet_to_json(sheet, { defval: \"\" });\r\n    acceptStudentList(data);\r\n  };\r\n  reader.readAsArrayBuffer(file);\r\n}\r\n\r\n// 将多样的性别字段转为统一的 male/female\r\nfunction normalizeGender(value) {\r\n  const cleaned = String(value).trim();\r\n  return GENDER_LABEL[cleaned] || \"unknown\";\r\n}\r\n\r\n// 校验并接收学生名单\r\nfunction acceptStudentList(data) {\r\n  const normalized = data\r\n    .map((row) => ({\r\n      id: row.StudentID?.toString().trim(),\r\n      name: row.Name?.toString().trim(),\r\n      gender: normalizeGender(row.Gender),\r\n    }))\r\n    .filter((row) => row.id && row.name && row.gender !== \"unknown\");\r\n\r\n  if (!normalized.length) {\r\n    alert(\"未识别到有效的学生记录，请检查模板内容。\");\r\n    return;\r\n  }\r\n\r\n  state.students = normalized;\r\n  updateStudentPreview();\r\n  resetSeats();\r\n  elements.exportExcelBtn.disabled = true;\r\n  elements.exportImageBtn.disabled = true;\r\n}\r\n\r\n// 名单预览，包含序号列\r\nfunction updateStudentPreview() {\r\n  const total = state.students.length;\r\n  const male = state.students.filter((s) => s.gender === \"male\").length;\r\n  const female = state.students.filter((s) => s.gender === \"female\").length;\r\n  elements.studentSummary.textContent = `共 ${total} 人（男生 ${male} ，女生 ${female}）。`;\r\n  elements.studentTableWrapper.classList.remove(\"hidden\");\r\n  elements.studentTableBody.innerHTML = state.students\r\n    .map(\r\n      (s, idx) => `\r\n        <tr>\r\n          <td>${idx + 1}</td>\r\n          <td>${s.id}</td>\r\n          <td>${s.name}</td>\r\n          <td>${s.gender === \"male\" ? \"男\" : \"女\"}</td>\r\n        </tr>\r\n      `\r\n    )\r\n    .join(\"\");\r\n}\r\n\r\n// 上传新名单后，清空当前座位\r\nfunction resetSeats() {\r\n  state.seats = [];\r\n  state.selectedSeatIndexes.clear();\r\n  elements.seatGrid.innerHTML = \"请设置行列并生成座位。\";\r\n  elements.seatGrid.classList.add(\"empty\");\r\n  elements.rowHeaders.innerHTML = \"\";\r\n  elements.colHeaders.innerHTML = \"\";\r\n  elements.gridWrapper.classList.add(\"inactive\");\r\n  refreshActionButtons();\r\n}\r\n\r\n// 生成座位：随机打乱学生并填充网格\r\nfunction handleGenerateSeats() {\r\n  if (!state.students.length) {\r\n    alert(\"请先上传学生名单。\");\r\n    return;\r\n  }\r\n  const rows = Number(elements.rowsInput.value);\r\n  const cols = Number(elements.colsInput.value);\r\n  if (rows <= 0 || cols <= 0) {\r\n    alert(\"行列数必须大于 0。\");\r\n    return;\r\n  }\r\n  const capacity = rows * cols;\r\n  if (capacity < state.students.length) {\r\n    alert(`座位数不足（当前容量 ${capacity}，学生 ${state.students.length}）。请增加行列数。`);\r\n    return;\r\n  }\r\n  state.gridConfig = {\r\n    rows,\r\n    cols,\r\n    seatSize: Number(elements.seatSizeInput.value),\r\n  };\r\n  const shuffled = [...state.students].sort(() => Math.random() - 0.5);\r\n  state.seats = Array.from({ length: capacity }, (_, idx) => ({\r\n    seatIndex: idx,\r\n    student: shuffled[idx] || null,\r\n  }));\r\n  state.selectedSeatIndexes.clear();\r\n  renderSeatGrid();\r\n  elements.exportExcelBtn.disabled = false;\r\n  elements.exportImageBtn.disabled = false;\r\n}\r\n\r\n// 渲染座位网格，同时展示“第X行/第Y列”与连续序号\r\nfunction renderSeatGrid() {\r\n  const { rows, cols, seatSize } = state.gridConfig;\r\n  const gridTemplate = `repeat(${cols}, ${seatSize}px)`;\r\n  elements.seatGrid.style.gridTemplateColumns = gridTemplate;\r\n  elements.seatGrid.style.gridTemplateRows = `repeat(${rows}, ${seatSize}px)`;\r\n  elements.seatGrid.classList.remove(\"empty\");\r\n  elements.seatGrid.innerHTML = \"\";\r\n  renderGridHeaders(rows, cols, seatSize);\r\n\r\n  state.seats.forEach((seat, idx) => {\r\n    const row = Math.floor(idx / cols) + 1;\r\n    const col = (idx % cols) + 1;\r\n    const serialNumber = (row - 1) * cols + col; // 第二行第一列会接续上一行计数\r\n    const seatDiv = document.createElement(\"div\");\r\n    seatDiv.className = [\"seat\", seat.student ? seat.student.gender : \"empty\"]\r\n      .concat(state.selectedSeatIndexes.has(idx) ? [\"selected\"] : [])\r\n      .join(\" \");\r\n    seatDiv.style.width = `${seatSize}px`;\r\n    seatDiv.style.height = `${seatSize}px`;\r\n    seatDiv.dataset.index = idx;\r\n    seatDiv.innerHTML = seat.student\r\n      ? `\r\n        <div class=\"serial\">序号 ${serialNumber}</div>\r\n        <div class=\"position\">第${row}行第${col}列</div>\r\n        <div class=\"name\">${seat.student.name}</div>\r\n        <div class=\"sid\">${seat.student.id}</div>\r\n      `\r\n      : `\r\n        <div class=\"serial\">序号 ${serialNumber}</div>\r\n        <div class=\"position\">第${row}行第${col}列</div>\r\n        <div class=\"name\">空</div>\r\n      `;\r\n    seatDiv.addEventListener(\"click\", () => toggleSeatSelection(idx));\r\n    elements.seatGrid.appendChild(seatDiv);\r\n  });\r\n  refreshActionButtons();\r\n}\r\n\r\n// 点击座位即可选择/反选\r\nfunction toggleSeatSelection(index) {\r\n  if (!state.seats.length) return;\r\n  if (state.selectedSeatIndexes.has(index)) {\r\n    state.selectedSeatIndexes.delete(index);\r\n  } else {\r\n    state.selectedSeatIndexes.add(index);\r\n  }\r\n  renderSeatGrid();\r\n}\r\n\r\n// 根据选择数量更新按钮状态\r\nfunction refreshActionButtons() {\r\n  const count = state.selectedSeatIndexes.size;\r\n  elements.swapBtn.disabled = count !== 2;\r\n  elements.reshuffleSelectionBtn.disabled = count < 2;\r\n  elements.clearSelectionBtn.disabled = count === 0;\r\n}\r\n\r\n// 绘制行/列标题，满足“第几行第几列”的展示要求\r\nfunction renderGridHeaders(rows, cols, seatSize) {\r\n  elements.gridWrapper.classList.toggle(\"inactive\", !state.seats.length);\r\n  elements.colHeaders.style.gridTemplateColumns = `repeat(${cols}, ${seatSize}px)`;\r\n  elements.rowHeaders.style.gridTemplateRows = `repeat(${rows}, ${seatSize}px)`;\r\n  elements.colHeaders.innerHTML = Array.from(\r\n    { length: cols },\r\n    (_, idx) => `<div class=\"header-item\">第${idx + 1}列</div>`\r\n  ).join(\"\");\r\n  elements.rowHeaders.innerHTML = Array.from(\r\n    { length: rows },\r\n    (_, idx) => `<div class=\"header-item\">第${idx + 1}行</div>`\r\n  ).join(\"\");\r\n}\r\n\r\n// 选中两个座位后互换\r\nfunction swapSelectedSeats() {\r\n  if (state.selectedSeatIndexes.size !== 2) return;\r\n  const [a, b] = Array.from(state.selectedSeatIndexes);\r\n  const temp = state.seats[a].student;\r\n  state.seats[a].student = state.seats[b].student;\r\n  state.seats[b].student = temp;\r\n  state.selectedSeatIndexes.clear();\r\n  renderSeatGrid();\r\n}\r\n\r\n// 批量随机：仅对选中的座位重新洗牌\r\nfunction reshuffleSelectedSeats() {\r\n  const indexes = Array.from(state.selectedSeatIndexes);\r\n  if (indexes.length < 2) return;\r\n  const students = indexes.map((idx) => state.seats[idx].student).filter(Boolean);\r\n  if (!students.length) {\r\n    alert(\"所选座位中没有学生可用于随机。\");\r\n    return;\r\n  }\r\n  const shuffled = [...students].sort(() => Math.random() - 0.5);\r\n  const seatMeta = indexes.map((idx) => ({\r\n    idx,\r\n    hadStudent: Boolean(state.seats[idx].student),\r\n  }));\r\n  seatMeta.forEach(({ idx, hadStudent }) => {\r\n    state.seats[idx].student = hadStudent ? shuffled.pop() || null : null;\r\n  });\r\n  state.selectedSeatIndexes.clear();\r\n  renderSeatGrid();\r\n}\r\n\r\n// 清空所选座位，便于手动调整\r\nfunction clearSelectedSeats() {\r\n  state.selectedSeatIndexes.forEach((idx) => {\r\n    state.seats[idx].student = null;\r\n  });\r\n  state.selectedSeatIndexes.clear();\r\n  renderSeatGrid();\r\n}\r\n\r\n// 导出电子表格：包含序号、行列、性别等字段\r\nfunction exportExcel() {\r\n  if (!state.seats.length) return;\r\n  const { rows, cols } = state.gridConfig;\r\n  const data = state.seats.map((seat, idx) => {\r\n    const row = Math.floor(idx / cols) + 1;\r\n    const col = (idx % cols) + 1;\r\n    return {\r\n      SerialNumber: idx + 1,\r\n      Row: row,\r\n      Column: col,\r\n      Seat: `${row}行${col}列`,\r\n      StudentID: seat.student?.id || \"\",\r\n      Name: seat.student?.name || \"\",\r\n      Gender: seat.student ? (seat.student.gender === \"male\" ? \"男\" : \"女\") : \"\",\r\n    };\r\n  });\r\n  const ws = XLSX.utils.json_to_sheet(data);\r\n  const wb = XLSX.utils.book_new();\r\n  XLSX.utils.book_append_sheet(wb, ws, \"Seats\");\r\n  XLSX.writeFile(wb, \"seat_plan.xlsx\");\r\n}\r\n\r\n// 导出座位图为 PNG，使用 html2canvas\r\nfunction exportImage() {\r\n  if (!state.seats.length) return;\r\n  html2canvas(elements.gridWrapper).then((canvas) => {\r\n    const link = document.createElement(\"a\");\r\n    link.href = canvas.toDataURL(\"image/png\");\r\n    link.download = \"seat_plan.png\";\r\n    link.click();\r\n  });\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", init);\r\n\r\n"],"names":[],"version":3,"file":"my-project.579125c3.js.map","sourceRoot":"/__parcel_source_root/"}